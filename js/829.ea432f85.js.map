{"version":3,"file":"js/829.ea432f85.js","mappings":"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","sources":["webpack://meiban-app/./src/services/astrologyApiService.js"],"sourcesContent":["/**\n * æ˜Ÿç›˜APIæœåŠ¡ - é›†æˆç¬¬ä¸‰æ–¹æ˜Ÿç›˜API\n * src/services/astrologyApiService.js\n */\n\nimport { getCoordinatesFromLocation } from '../utils/cityCoordinates.js';\n\n// APIé…ç½®\nconst API_CONFIG = {\n  // ä½¿ç”¨ Cloudflare Worker ä»£ç†\n  baseUrl: 'https://xingpan-proxy.kidyuan.workers.dev',\n  // Worker ä¼šåœ¨æœåŠ¡ç«¯æ³¨å…¥ access_tokenï¼Œå‰ç«¯ä¸éœ€è¦æºå¸¦\n  // APIå‚æ•°é…ç½®\n  defaultParams: {\n    h_sys: 'P', // å®«ä½ç³»ç»Ÿ\n    planets: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 't'], // è¡Œæ˜Ÿåˆ—è¡¨\n    virtual: ['10'], // è™šç‚¹\n    // ç›¸ä½é…ç½®\n    phase: {\n      '0': 0,\n      '30': 2,\n      '36': 2, \n      '45': 2,\n      '60': 6,\n      '72': 2,\n      '90': 6,\n      '120': 6,\n      '135': 0.5,\n      '144': 2,\n      '150': 2,\n      '180': 6\n    },\n    ay: '-1',\n    tomorrow_type: '1',\n    svg_type: '1'\n  },\n  // è¯·æ±‚è¶…æ—¶æ—¶é—´\n  timeout: 15000,\n  // æœ€å¤§é‡è¯•æ¬¡æ•°\n  maxRetries: 2\n};\n\n/**\n * æ ¼å¼åŒ–å‡ºç”Ÿæ—¥æœŸæ—¶é—´\n * @param {string} birthdate - å‡ºç”Ÿæ—¥æœŸ (YYYY-MM-DD)\n * @param {number} birthHour - å‡ºç”Ÿå°æ—¶\n * @param {number} birthMinute - å‡ºç”Ÿåˆ†é’Ÿ\n * @returns {string} æ ¼å¼åŒ–çš„æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²\n */\nfunction formatBirthDateTime(birthdate, birthHour, birthMinute) {\n  const hour = String(birthHour || 0).padStart(2, '0');\n  const minute = String(birthMinute || 0).padStart(2, '0');\n  return `${birthdate} ${hour}:${minute}`;\n}\n\n/**\n * è·å–åŸå¸‚åæ ‡ä¿¡æ¯\n * @param {string} birthplace - å‡ºç”Ÿåœ°åç§°\n * @returns {Object} åŒ…å«ç»çº¬åº¦çš„å¯¹è±¡\n */\nfunction getLocationCoordinates(birthplace) {\n  try {\n    // å°è¯•ä»åŸå¸‚åæ ‡æ•°æ®ä¸­è·å–\n    const coordinates = getCoordinatesFromLocation(birthplace);\n    if (coordinates && coordinates.lat && coordinates.lng) {\n      return {\n        latitude: coordinates.lat,\n        longitude: coordinates.lng\n      };\n    }\n    \n    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å›å¤©å°å¿çš„åæ ‡ä½œä¸ºé»˜è®¤å€¼\n    console.warn(`æœªæ‰¾åˆ° ${birthplace} çš„åæ ‡ä¿¡æ¯ï¼Œä½¿ç”¨é»˜è®¤åæ ‡`);\n    return {\n      latitude: 29.13,\n      longitude: 121.03\n    };\n  } catch (error) {\n    console.error('è·å–åæ ‡ä¿¡æ¯å¤±è´¥:', error);\n    // è¿”å›å¤©å°å¿åæ ‡ä½œä¸ºåå¤‡\n    return {\n      latitude: 29.13,\n      longitude: 121.03\n    };\n  }\n}\n\n/**\n * æ„å»ºAPIè¯·æ±‚å‚æ•°\n * @param {Object} userData - ç”¨æˆ·æ•°æ®\n * @returns {Object} APIè¯·æ±‚å‚æ•°\n */\nfunction buildApiParams(userData) {\n  const { birthdate, birthHour, birthMinute, birthplace } = userData;\n  \n  // è·å–åæ ‡ä¿¡æ¯\n  const coordinates = getLocationCoordinates(birthplace);\n  \n  // æ ¼å¼åŒ–å‡ºç”Ÿæ—¶é—´\n  const formattedDateTime = formatBirthDateTime(birthdate, birthHour, birthMinute);\n  \n  // æ„å»ºè¯·æ±‚å‚æ•°ï¼ˆä¸åŒ…å« access_tokenï¼Œç”± Worker åœ¨æœåŠ¡ç«¯æ³¨å…¥ï¼‰\n  const params = {\n    longitude: coordinates.longitude.toString(),\n    latitude: coordinates.latitude.toString(),\n    tz: '8.00', // ä¸­å›½æ—¶åŒº UTC+8\n    h_sys: API_CONFIG.defaultParams.h_sys,\n    birthday: formattedDateTime,\n    ay: API_CONFIG.defaultParams.ay,\n    tomorrow_type: API_CONFIG.defaultParams.tomorrow_type,\n    svg_type: API_CONFIG.defaultParams.svg_type\n  };\n  \n  // æ·»åŠ è¡Œæ˜Ÿå‚æ•°\n  API_CONFIG.defaultParams.planets.forEach((planet, index) => {\n    params[`planets[${index}]`] = planet;\n  });\n  \n  // æ·»åŠ è™šç‚¹å‚æ•°\n  API_CONFIG.defaultParams.virtual.forEach((virtual, index) => {\n    params[`virtual[${index}]`] = virtual;\n  });\n  \n  // æ·»åŠ ç›¸ä½å‚æ•°\n  Object.entries(API_CONFIG.defaultParams.phase).forEach(([angle, value]) => {\n    params[`phase[${angle}]`] = value;\n  });\n  \n  return params;\n}\n\n/**\n * å‘é€APIè¯·æ±‚\n * @param {Object} params - è¯·æ±‚å‚æ•°\n * @returns {Promise<Object>} APIå“åº”æ•°æ®\n */\nasync function sendApiRequest(params) {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), API_CONFIG.timeout);\n  \n  try {\n    // æ„å»ºURLSearchParams\n    const formData = new URLSearchParams();\n    Object.entries(params).forEach(([key, value]) => {\n      formData.append(key, value);\n    });\n    \n    console.log('ğŸš€ å‘é€æ˜Ÿç›˜APIè¯·æ±‚ (é€šè¿‡Cloudflare Worker):', API_CONFIG.baseUrl);\n    console.log('ğŸ“‹ è¯·æ±‚å‚æ•°:', params);\n    console.log('ğŸ“¤ è¯·æ±‚ä½“ (form-data):', formData.toString());\n\n    const response = await fetch(API_CONFIG.baseUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Origin': window.location.origin // ä¸º CORS è®¾ç½®æ­£ç¡®çš„ Origin\n      },\n      body: formData,\n      signal: controller.signal\n    });\n    \n    clearTimeout(timeoutId);\n    \n    if (!response.ok) {\n      throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`);\n    }\n    \n    const responseText = await response.text();\n    console.log('ğŸ“¥ åŸå§‹å“åº”:', responseText);\n\n    let data;\n    try {\n      data = JSON.parse(responseText);\n    } catch (parseError) {\n      console.error('âŒ JSONè§£æå¤±è´¥:', parseError);\n      throw new Error(`å“åº”è§£æå¤±è´¥: ${responseText}`);\n    }\n\n    console.log('âœ… APIå“åº”æˆåŠŸ');\n    console.log('ğŸ“¦ å“åº”æ•°æ®:', data);\n\n    if (data.code !== 0) {\n      throw new Error(`APIè¿”å›é”™è¯¯ (code: ${data.code}): ${data.msg || 'æœªçŸ¥é”™è¯¯'}`);\n    }\n    \n    return data;\n    \n  } catch (error) {\n    clearTimeout(timeoutId);\n    \n    if (error.name === 'AbortError') {\n      throw new Error('APIè¯·æ±‚è¶…æ—¶');\n    }\n    \n    console.error('âŒ APIè¯·æ±‚å¤±è´¥:', error);\n    throw error;\n  }\n}\n\n/**\n * å¸¦é‡è¯•æœºåˆ¶çš„APIè°ƒç”¨\n * @param {Object} userData - ç”¨æˆ·æ•°æ®\n * @returns {Promise<Object>} APIå“åº”æ•°æ®\n */\nasync function callApiWithRetry(userData) {\n  const params = buildApiParams(userData);\n  let lastError;\n  \n  for (let attempt = 1; attempt <= API_CONFIG.maxRetries; attempt++) {\n    try {\n      console.log(`ğŸ”„ APIè°ƒç”¨å°è¯• ${attempt}/${API_CONFIG.maxRetries}`);\n      const result = await sendApiRequest(params);\n      return result;\n    } catch (error) {\n      lastError = error;\n      \n      if (attempt < API_CONFIG.maxRetries) {\n        const delay = Math.pow(2, attempt) * 1000; // æŒ‡æ•°é€€é¿\n        console.warn(`âš ï¸ ç¬¬${attempt}æ¬¡å°è¯•å¤±è´¥ï¼Œ${delay}msåé‡è¯•:`, error.message);\n        await new Promise(resolve => setTimeout(resolve, delay));\n      }\n    }\n  }\n  \n  console.error(`âŒ APIè°ƒç”¨å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•° (${API_CONFIG.maxRetries}):`, lastError);\n  throw lastError;\n}\n\n/**\n * è·å–æ˜Ÿç›˜æ•°æ®çš„ä¸»è¦æ¥å£\n * @param {Object} userData - ç”¨æˆ·è¾“å…¥æ•°æ®\n * @returns {Promise<Object>} å¤„ç†åçš„æ˜Ÿç›˜æ•°æ®\n */\nexport async function fetchAstrologyData(userData) {\n  try {\n    // éªŒè¯è¾“å…¥æ•°æ®\n    if (!userData || !userData.birthdate || !userData.birthplace) {\n      throw new Error('ç¼ºå°‘å¿…è¦çš„å‡ºç”Ÿä¿¡æ¯ï¼ˆæ—¥æœŸå’Œåœ°ç‚¹ï¼‰');\n    }\n    \n    console.log('ğŸŒŸ å¼€å§‹è·å–æ˜Ÿç›˜æ•°æ®');\n    console.log('ğŸ‘¤ ç”¨æˆ·æ•°æ®:', userData);\n    \n    // è°ƒç”¨API\n    const apiResponse = await callApiWithRetry(userData);\n    \n    if (!apiResponse.data) {\n      throw new Error('APIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯');\n    }\n    \n    console.log('ğŸ¯ æ˜Ÿç›˜æ•°æ®è·å–æˆåŠŸ');\n    return apiResponse.data;\n    \n  } catch (error) {\n    console.error('ğŸš« è·å–æ˜Ÿç›˜æ•°æ®å¤±è´¥:', error);\n    throw new Error(`æ˜Ÿç›˜APIè°ƒç”¨å¤±è´¥: ${error.message}`);\n  }\n}\n\n/**\n * æ£€æŸ¥APIæœåŠ¡æ˜¯å¦å¯ç”¨\n * @returns {Promise<boolean>} APIæœåŠ¡å¯ç”¨æ€§\n */\nexport async function checkApiHealth() {\n  try {\n    // ä½¿ç”¨æµ‹è¯•æ•°æ®æ£€æŸ¥API\n    const testData = {\n      birthdate: '1981-11-17',\n      birthHour: 0,\n      birthMinute: 50,\n      birthplace: 'æµ™æ±Ÿçœå°å·å¸‚å¤©å°å¿'\n    };\n    \n    await fetchAstrologyData(testData);\n    return true;\n  } catch (error) {\n    console.error('APIå¥åº·æ£€æŸ¥å¤±è´¥:', error);\n    return false;\n  }\n}\n\n/**\n * è®¾ç½®APIä»¤ç‰Œ (å·²å¼ƒç”¨ï¼ŒWorker æ¨¡å¼ä¸‹ç”±æœåŠ¡ç«¯ç®¡ç†)\n * @param {string} token - APIä»¤ç‰Œ (Worker æ¨¡å¼ä¸‹å¿½ç•¥)\n * @deprecated Worker æ¨¡å¼ä¸‹ token ç”±æœåŠ¡ç«¯ç®¡ç†ï¼Œæ­¤æ–¹æ³•å·²æ— æ•ˆ\n */\nexport function setApiToken() {\n  console.warn('âš ï¸ Worker æ¨¡å¼ä¸‹ API ä»¤ç‰Œç”±æœåŠ¡ç«¯ç®¡ç†ï¼ŒsetApiToken æ–¹æ³•å·²æ— æ•ˆ');\n}\n\n/**\n * è·å–å½“å‰APIé…ç½®\n * @returns {Object} å½“å‰é…ç½®ä¿¡æ¯ï¼ˆä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰\n */\nexport function getApiConfig() {\n  return {\n    baseUrl: API_CONFIG.baseUrl,\n    timeout: API_CONFIG.timeout,\n    maxRetries: API_CONFIG.maxRetries,\n    proxyMode: 'Cloudflare Worker',\n    tokenManagement: 'Server-side'\n  };\n}\n\n// å¯¼å‡ºé»˜è®¤é…ç½®ä¾›æµ‹è¯•ä½¿ç”¨\nexport { API_CONFIG };"],"names":["API_CONFIG","baseUrl","defaultParams","h_sys","planets","virtual","phase","ay","tomorrow_type","svg_type","timeout","maxRetries","formatBirthDateTime","birthdate","birthHour","birthMinute","hour","String","padStart","minute","concat","getLocationCoordinates","birthplace","coordinates","getCoordinatesFromLocation","lat","lng","latitude","longitude","console","warn","error","buildApiParams","userData","formattedDateTime","params","toString","tz","birthday","forEach","planet","index","Object","entries","_ref","_ref2","_slicedToArray","angle","value","sendApiRequest","_x","_sendApiRequest","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","controller","timeoutId","formData","response","responseText","data","wrap","_context","prev","next","AbortController","setTimeout","abort","URLSearchParams","_ref3","_ref4","key","append","log","fetch","method","headers","window","location","origin","body","signal","sent","clearTimeout","ok","Error","status","statusText","text","JSON","parse","t0","code","msg","abrupt","t1","name","stop","callApiWithRetry","_x2","_callApiWithRetry","_callee2","lastError","_loop","_ret","attempt","_context3","result","delay","_context2","v","Math","pow","message","Promise","resolve","delegateYield","fetchAstrologyData","_x3","_fetchAstrologyData","_callee3","apiResponse","_context4","checkApiHealth","_checkApiHealth","_callee4","testData","_context5","setApiToken","getApiConfig","proxyMode","tokenManagement"],"sourceRoot":""}