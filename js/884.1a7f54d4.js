"use strict";(self["webpackChunkmeiban_app"]=self["webpackChunkmeiban_app"]||[]).push([[884],{51884:(e,n,r)=>{r.r(n),r.d(n,{PLANET_CODE_MAP:()=>o,ZODIAC_MAPPING:()=>i,ZODIAC_REVERSE_MAPPING:()=>s,convertApiDataToAppFormat:()=>d,convertZodiacName:()=>l,createCompatibleAstrologyData:()=>m,validateConvertedData:()=>f});var t=r(54119),a=r(78676),o=(r(16280),r(76918),r(2008),r(51629),r(74423),r(64346),r(62062),r(44114),r(1688),r(23288),r(18111),r(22489),r(7588),r(61701),r(5506),r(53921),r(79432),r(26099),r(21699),r(42781),r(23500),{0:"sun",1:"moon",2:"mercury",3:"venus",4:"mars",5:"jupiter",6:"saturn",7:"uranus",8:"neptune",9:"pluto",t:"trueNode",10:"ascendant"}),i={Aries:"白羊座",Taurus:"金牛座",Gemini:"双子座",Cancer:"巨蟹座",Leo:"狮子座",Virgo:"处女座",Libra:"天秤座",Scorpio:"天蝎座",Sagittarius:"射手座",Capricorn:"摩羯座",Aquarius:"水瓶座",Pisces:"双鱼座"},s=Object.fromEntries(Object.entries(i).map((function(e){var n=(0,a.A)(e,2),r=n[0],t=n[1];return[t,r]})));function l(e){return i[e]||e}function c(e){var n={};if(!e.planet||!Array.isArray(e.planet))return console.warn("API数据中缺少行星信息"),n;e.planet.forEach((function(e){var r=o[e.code_name];r&&e.sign&&(n[r]={sign:l(e.sign.sign_english),degree:e.sign.deg||0,minute:e.sign.min||0,second:e.sign.sec||0,longitude:e.longitude||0,_raw:{code_name:e.code_name,planet_english:e.planet_english,planet_chinese:e.planet_chinese,house_id:e.house_id,speed:e.speed}})}));var r=["sun","moon","ascendant"],t=r.filter((function(e){return!n[e]}));return t.length>0&&console.warn("缺少重要行星数据:",t),n}function u(e){var n={};return e.house&&Array.isArray(e.house)?(e.house.forEach((function(e){var r=e.house_id;n[r]={sign:l(e.sign.sign_english),degree:e.sign.deg||0,minute:e.sign.min||0,second:e.sign.sec||0,longitude:e.longitude||0,life_palace:e.house_life||"",planets:(e.planet_array||[]).map((function(e){return{code_name:e.code_name,name:e.planet_chinese,degree:e.deg||0,minute:e.min||0,second:e.sec||0}})),coordinates:{x:e.z_x,y:e.z_y}}})),n):(console.warn("API数据中缺少宫位信息"),n)}function g(e){var n=[];return e.planet?(e.planet.forEach((function(e){e.planet_allow_degree&&Array.isArray(e.planet_allow_degree)&&e.planet_allow_degree.forEach((function(r){var t=o[e.code_name],a=o[r.code_name];t&&a&&n.push({planet1:t,planet2:a,angle:r.allow||0,orb:{degree:r.deg||0,minute:r.min||0,second:r.sec||0},type:"1"===r.in_out?"applying":"separating"})}))})),n):n}function h(e){var n={elements:{fire:0,earth:0,air:0,water:0},qualities:{cardinal:0,fixed:0,mutable:0},polarities:{positive:0,negative:0}};if(!e.attribute)return n;var r={fire:["火相"],earth:["土相"],air:["风相"],water:["水相"]},t={cardinal:["本位"],fixed:["固定"],mutable:["变动"]};return Object.entries(e.attribute).forEach((function(e){var o=(0,a.A)(e,2),i=o[0],s=o[1];Array.isArray(s)&&(Object.entries(r).forEach((function(e){var r=(0,a.A)(e,2),t=r[0],o=r[1];o.includes(i)&&(n.elements[t]=s.length)})),Object.entries(t).forEach((function(e){var r=(0,a.A)(e,2),t=r[0],o=r[1];o.includes(i)&&(n.qualities[t]=s.length)})))})),n}function p(e,n){var r={career:3,wealth:3,love:3,health:3,overall:3};if(e.sun){var t=["白羊座","狮子座","射手座"];t.includes(e.sun.sign)&&(r.career+=1)}if(e.moon){var a=["巨蟹座","天蝎座","双鱼座"];a.includes(e.moon.sign)&&(r.love+=1)}var o=n.filter((function(e){return[60,120].includes(e.angle)})),i=n.filter((function(e){return[90,180].includes(e.angle)}));return r.overall+=.5*o.length-.3*i.length,Object.keys(r).forEach((function(e){r[e]=Math.max(1,Math.min(5,Math.round(r[e])))})),r}function d(e){try{console.log("🔄 开始转换API数据格式"),console.log("📥 原始API数据:",e);var n=c(e),r=u(e),t=g(e),a=h(e),o=p(n,t),i={astrologyPositions:n,houses:r,aspects:t,elementDistribution:a,fortune:{overview:o.overall>=4?"大吉":o.overall>=3?"中吉":"平常",career:"★".repeat(o.career)+"☆".repeat(5-o.career),wealth:"★".repeat(o.wealth)+"☆".repeat(5-o.wealth),love:"★".repeat(o.love)+"☆".repeat(5-o.love),health:"★".repeat(o.health)+"☆".repeat(5-o.health),scores:o},chart:{svg:e.svg||null,hasChart:!!e.svg},_rawApiData:null,_convertedAt:(new Date).toISOString()};return console.log("✅ 数据转换完成"),console.log("📤 转换后数据:",i),i}catch(s){throw console.error("❌ 数据转换失败:",s),new Error("数据转换失败: ".concat(s.message))}}function f(e){var n={isValid:!0,errors:[],warnings:[]},r=["sun","moon","ascendant"];return r.forEach((function(r){e.astrologyPositions[r]||(n.errors.push("缺少".concat(r,"位置信息")),n.isValid=!1)})),e.astrologyPositions&&"object"===(0,t.A)(e.astrologyPositions)||(n.errors.push("行星位置数据格式错误"),n.isValid=!1),e.fortune||n.warnings.push("缺少运势信息"),(!e.houses||Object.keys(e.houses).length<12)&&n.warnings.push("宫位数据不完整"),n}function m(e){var n=d(e),r=f(n);if(!r.isValid)throw console.error("数据验证失败:",r.errors),new Error("转换的数据不满足应用要求");return r.warnings.length>0&&console.warn("数据验证警告:",r.warnings),{astrologyPositions:n.astrologyPositions,fortune:n.fortune,houses:n.houses,aspects:n.aspects,elementDistribution:n.elementDistribution,chart:n.chart,dataSource:"xingpan_api",timestamp:(new Date).toISOString()}}},53921:(e,n,r)=>{var t=r(46518),a=r(72652),o=r(97040);t({target:"Object",stat:!0},{fromEntries:function(e){var n={};return a(e,(function(e,r){o(n,e,r)}),{AS_ENTRIES:!0}),n}})}}]);
//# sourceMappingURL=884.1a7f54d4.js.map