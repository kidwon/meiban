"use strict";(self["webpackChunkmeiban_app"]=self["webpackChunkmeiban_app"]||[]).push([[117],{29117:(e,t,n)=>{n.d(t,{A:()=>q});n(50778);var a=n(56768),s=n(24232),r=n(45130),c={class:"share-container"},o=["disabled"],i={class:"share-text"},l={key:0,class:"share-success"},u={class:"share-panel-header"},h={class:"share-content"},p={class:"share-preview"},d=["src","alt"],m={class:"share-info"},w={class:"share-options"},k={class:"share-url"},f=["value"];function g(e,t,n,g,y,v){return(0,a.uX)(),(0,a.CE)("div",c,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=function(){return v.handleShare&&v.handleShare.apply(v,arguments)}),class:(0,s.C4)(["btn btn--secondary share-btn",{wechat:y.isWechatBrowser}]),disabled:y.loading},[t[8]||(t[8]=(0,a.Lk)("span",{class:"share-icon"},"📤",-1)),(0,a.Lk)("span",i,(0,s.v_)(v.shareButtonText),1)],10,o),(0,a.bF)(r.eB,{name:"fade"},{default:(0,a.k6)((function(){return[y.showSuccessMessage?((0,a.uX)(),(0,a.CE)("div",l,(0,s.v_)(e.$t("share.success")),1)):(0,a.Q3)("",!0)]})),_:1}),(0,a.bF)(r.eB,{name:"slide-up"},{default:(0,a.k6)((function(){return[y.showSharePanel?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"share-panel",onClick:t[6]||(t[6]=(0,r.D$)((function(){}),["stop"]))},[(0,a.Lk)("div",u,[(0,a.Lk)("h3",null,(0,s.v_)(e.$t("share.title")),1),(0,a.Lk)("button",{onClick:t[1]||(t[1]=function(){return v.closeSharePanel&&v.closeSharePanel.apply(v,arguments)}),class:"close-btn"},"×")]),(0,a.Lk)("div",h,[(0,a.Lk)("div",p,[(0,a.Lk)("img",{src:y.shareData.imgUrl,alt:y.shareData.title,class:"share-image"},null,8,d),(0,a.Lk)("div",m,[(0,a.Lk)("h4",null,(0,s.v_)(y.shareData.title),1),(0,a.Lk)("p",null,(0,s.v_)(y.shareData.desc),1)])]),(0,a.Lk)("div",w,[(0,a.Lk)("button",{onClick:t[2]||(t[2]=function(){return v.copyLink&&v.copyLink.apply(v,arguments)}),class:"share-option"},[t[9]||(t[9]=(0,a.Lk)("span",{class:"option-icon"},"📋",-1)),(0,a.Lk)("span",null,(0,s.v_)(e.$t("share.copyLink")),1)]),y.isWechatBrowser?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[3]||(t[3]=function(){return v.shareToQQ&&v.shareToQQ.apply(v,arguments)}),class:"share-option"},[t[10]||(t[10]=(0,a.Lk)("span",{class:"option-icon"},"🐧",-1)),(0,a.Lk)("span",null,(0,s.v_)(e.$t("share.qq")),1)])),y.isWechatBrowser?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:t[4]||(t[4]=function(){return v.shareToWeibo&&v.shareToWeibo.apply(v,arguments)}),class:"share-option"},[t[11]||(t[11]=(0,a.Lk)("span",{class:"option-icon"},"🏮",-1)),(0,a.Lk)("span",null,(0,s.v_)(e.$t("share.weibo")),1)])),(0,a.Lk)("button",{onClick:t[5]||(t[5]=function(){return v.shareToEmail&&v.shareToEmail.apply(v,arguments)}),class:"share-option"},[t[12]||(t[12]=(0,a.Lk)("span",{class:"option-icon"},"📧",-1)),(0,a.Lk)("span",null,(0,s.v_)(e.$t("share.email")),1)])]),(0,a.Lk)("div",k,[(0,a.Lk)("input",{ref:"urlInput",type:"text",value:y.shareData.link,readonly:"",class:"url-input"},null,8,f)])])])):(0,a.Q3)("",!0)]})),_:1}),y.showSharePanel?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"share-overlay",onClick:t[7]||(t[7]=function(){return v.closeSharePanel&&v.closeSharePanel.apply(v,arguments)})})):(0,a.Q3)("",!0)])}var y=n(14048),v=n(41034),S=n(30388),b=(n(28706),n(74423),n(76031),n(24949));n(16280),n(76918),n(51629),n(34782),n(59089),n(23288),n(62010),n(26099),n(27495),n(90906),n(38781);function D(){return/micromessenger/i.test(navigator.userAgent)}function x(){return new Promise((function(e,t){if(window.wx)e(!0);else{var n=document.createElement("script");n.src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js",n.onload=function(){return e(!0)},n.onerror=function(){return t(new Error("微信JS-SDK加载失败"))},document.head.appendChild(n)}}))}function L(e){return T.apply(this,arguments)}function T(){return T=(0,S.A)((0,y.A)().mark((function e(t){var n;return(0,y.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,D()){e.next=4;break}return console.log("非微信环境，跳过微信分享配置"),e.abrupt("return",!1);case 4:return e.next=6,x();case 6:return n={debug:!1,appId:"your_app_id",timestamp:Math.floor(Date.now()/1e3),nonceStr:C(),signature:"your_signature",jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareQZone","updateAppMessageShareData","updateTimelineShareData"]},window.wx.config(n),window.wx.ready((function(){window.wx.updateAppMessageShareData({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:t.success||function(){return console.log("分享给朋友成功")},cancel:t.cancel||function(){return console.log("取消分享给朋友")}}),window.wx.updateTimelineShareData({title:t.title,link:t.link,imgUrl:t.imgUrl,success:t.success||function(){return console.log("分享到朋友圈成功")},cancel:t.cancel||function(){return console.log("取消分享到朋友圈")}}),window.wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:t.success,cancel:t.cancel}),window.wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:t.success,cancel:t.cancel}),console.log("微信分享配置成功")})),window.wx.error((function(e){console.error("微信JS-SDK配置失败:",e)})),e.abrupt("return",!0);case 13:return e.prev=13,e.t0=e["catch"](0),console.error("配置微信分享失败:",e.t0),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,null,[[0,13]])}))),T.apply(this,arguments)}function C(){return Math.random().toString(36).slice(2,15)+Math.random().toString(36).slice(2,15)}function A(e){var t=[{property:"og:title",content:e.title},{property:"og:description",content:e.desc},{property:"og:image",content:e.imgUrl},{property:"og:url",content:e.link},{property:"og:type",content:"website"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:e.title},{name:"twitter:description",content:e.desc},{name:"twitter:image",content:e.imgUrl}];t.forEach((function(e){var t=e.property?'meta[property="'.concat(e.property,'"]'):'meta[name="'.concat(e.name,'"]'),n=document.querySelector(t);n&&n.remove()})),t.forEach((function(e){var t=document.createElement("meta");e.property?t.setAttribute("property",e.property):t.setAttribute("name",e.name),t.setAttribute("content",e.content),document.head.appendChild(t)}))}function U(e,t){window.gtag&&window.gtag("event","share",{method:e,content_type:t,content_id:window.location.pathname}),console.log("分享统计: ".concat(e," - ").concat(t))}const _={name:"ShareButton",props:{userData:{type:Object,required:!0},calculationResults:{type:Object,required:!0},analysisType:{type:String,default:"astrology",validator:function(e){return["astrology","bazi"].includes(e)}}},data:function(){return{loading:!1,showSharePanel:!1,showSuccessMessage:!1,shareData:null,isWechatBrowser:!1}},computed:{shareButtonText:function(){return this.loading?this.$t("share.generating"):this.isWechatBrowser?this.$t("share.wechat"):this.$t("share.share")}},mounted:function(){this.isWechatBrowser=D(),this.prepareShareData()},methods:{prepareShareData:function(){var e=this;return(0,S.A)((0,y.A)().mark((function t(){var n,a;return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.loading=!0,n=(0,b.generateShareUrl)(e.userData,e.calculationResults,e.analysisType),(0,b.isUrlLengthReasonable)(n)||console.warn("分享URL过长，建议优化"),a=(0,b.generateShareContent)(e.userData,e.calculationResults,e.analysisType),e.shareData=(0,v.A)((0,v.A)({},a),{},{link:n}),A(e.shareData),!e.isWechatBrowser){t.next=10;break}return t.next=10,e.setupWechatShare();case 10:t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](0),console.error("准备分享数据失败:",t.t0),e.$emit("error",t.t0.message);case 16:return t.prev=16,e.loading=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[0,12,16,19]])})))()},setupWechatShare:function(){var e=this;return(0,S.A)((0,y.A)().mark((function t(){return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,L({title:e.shareData.title,desc:e.shareData.desc,link:e.shareData.link,imgUrl:e.shareData.imgUrl,success:function(){e.showSuccessMessage=!0,setTimeout((function(){e.showSuccessMessage=!1}),3e3),U("wechat",e.analysisType),e.$emit("shareSuccess","wechat")},cancel:function(){e.$emit("shareCancel","wechat")}});case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0),console.error("配置微信分享失败:",t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})))()},handleShare:function(){var e=this;return(0,S.A)((0,y.A)().mark((function t(){return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.loading&&e.shareData){t.next=2;break}return t.abrupt("return");case 2:e.isWechatBrowser?e.showWechatShareTip():e.showSharePanel=!0,U("button_click",e.analysisType);case 4:case"end":return t.stop()}}),t)})))()},showWechatShareTip:function(){this.$emit("showTip",this.$t("share.wechatTip"))},copyLink:function(){var e=this;return(0,S.A)((0,y.A)().mark((function t(){return(0,y.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.clipboard.writeText(e.shareData.link);case 3:e.showSuccessMessage=!0,setTimeout((function(){e.showSuccessMessage=!1}),2e3),U("copy_link",e.analysisType),e.$emit("shareSuccess","copy"),t.next=15;break;case 9:t.prev=9,t.t0=t["catch"](0),e.$refs.urlInput.select(),document.execCommand("copy"),e.showSuccessMessage=!0,setTimeout((function(){e.showSuccessMessage=!1}),2e3);case 15:case"end":return t.stop()}}),t,null,[[0,9]])})))()},shareToQQ:function(){var e="https://connect.qq.com/widget/shareqq/index.html?url=".concat(encodeURIComponent(this.shareData.link),"&title=").concat(encodeURIComponent(this.shareData.title),"&desc=").concat(encodeURIComponent(this.shareData.desc),"&pics=").concat(encodeURIComponent(this.shareData.imgUrl));window.open(e,"_blank"),U("qq",this.analysisType),this.$emit("shareSuccess","qq")},shareToWeibo:function(){var e="".concat(this.shareData.title," - ").concat(this.shareData.desc),t="https://service.weibo.com/share/share.php?url=".concat(encodeURIComponent(this.shareData.link),"&title=").concat(encodeURIComponent(e),"&pic=").concat(encodeURIComponent(this.shareData.imgUrl));window.open(t,"_blank"),U("weibo",this.analysisType),this.$emit("shareSuccess","weibo")},shareToEmail:function(){var e=encodeURIComponent(this.shareData.title),t=encodeURIComponent("".concat(this.shareData.desc,"\n\n").concat(this.shareData.link)),n="mailto:?subject=".concat(e,"&body=").concat(t);window.location.href=n,U("email",this.analysisType),this.$emit("shareSuccess","email")},closeSharePanel:function(){this.showSharePanel=!1}}};var M=n(71241);const $=(0,M.A)(_,[["render",g],["__scopeId","data-v-15729f98"]]),q=$},50778:(e,t,n)=>{var a=n(46518),s=n(77240),r=n(23061);a({target:"String",proto:!0,forced:r("link")},{link:function(e){return s(this,"a","href",e)}})}}]);
//# sourceMappingURL=117.582b1fea.js.map