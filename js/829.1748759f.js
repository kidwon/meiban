"use strict";(self["webpackChunkmeiban_app"]=self["webpackChunkmeiban_app"]||[]).push([[829],{87829:(t,e,r)=>{r.r(e),r.d(e,{API_CONFIG:()=>s,checkApiHealth:()=>m,fetchAstrologyData:()=>w,getApiConfig:()=>v,setApiToken:()=>g});var n=r(14048),a=r(30388),o=r(78676),c=(r(16280),r(76918),r(28706),r(51629),r(23288),r(62010),r(18111),r(7588),r(5506),r(26099),r(38781),r(47764),r(68156),r(23500),r(62953),r(76031),r(48408),r(14603),r(47566),r(98721),r(23171)),s={baseUrl:"http://www.xingpan.vip/astrology/chart/natal",defaultToken:"989f888c4283e2cc2d8a5aa4af60932c",defaultParams:{h_sys:"P",planets:["0","1","2","3","4","5","6","7","8","9","t"],virtual:["10"],phase:{0:0,30:2,36:2,45:2,60:6,72:2,90:6,120:6,135:.5,144:2,150:2,180:6},ay:"-1",tomorrow_type:"1",svg_type:"1"},timeout:15e3,maxRetries:2};function u(t,e,r){var n=String(e||0).padStart(2,"0"),a=String(r||0).padStart(2,"0");return"".concat(t," ").concat(n,":").concat(a)}function i(t){try{var e=(0,c.pk)(t);return e&&e.lat&&e.lng?{latitude:e.lat,longitude:e.lng}:(console.warn("未找到 ".concat(t," 的坐标信息，使用默认坐标")),{latitude:29.13,longitude:121.03})}catch(r){return console.error("获取坐标信息失败:",r),{latitude:29.13,longitude:121.03}}}function l(t){var e=t.birthdate,r=t.birthHour,n=t.birthMinute,a=t.birthplace,c=i(a),l=u(e,r,n),p={access_token:s.defaultToken,longitude:c.longitude.toString(),latitude:c.latitude.toString(),tz:"8.00",h_sys:s.defaultParams.h_sys,birthday:l,ay:s.defaultParams.ay,tomorrow_type:s.defaultParams.tomorrow_type,svg_type:s.defaultParams.svg_type};return s.defaultParams.planets.forEach((function(t,e){p["planets[".concat(e,"]")]=t})),s.defaultParams.virtual.forEach((function(t,e){p["virtual[".concat(e,"]")]=t})),Object.entries(s.defaultParams.phase).forEach((function(t){var e=(0,o.A)(t,2),r=e[0],n=e[1];p["phase[".concat(r,"]")]=n})),p}function p(t){return h.apply(this,arguments)}function h(){return h=(0,a.A)((0,n.A)().mark((function t(e){var r,a,c,u,i;return(0,n.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=new AbortController,a=setTimeout((function(){return r.abort()}),s.timeout),t.prev=2,c=new URLSearchParams,Object.entries(e).forEach((function(t){var e=(0,o.A)(t,2),r=e[0],n=e[1];c.append(r,n)})),console.log("🚀 发送星盘API请求:",s.baseUrl),console.log("📋 请求参数:",e),t.next=9,fetch(s.baseUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":"MeibanApp/2.0"},body:c,signal:r.signal});case 9:if(u=t.sent,clearTimeout(a),u.ok){t.next=13;break}throw new Error("API请求失败: ".concat(u.status," ").concat(u.statusText));case 13:return t.next=15,u.json();case 15:if(i=t.sent,console.log("✅ API响应成功"),console.log("📦 响应数据:",i),0===i.code){t.next=20;break}throw new Error("API返回错误: ".concat(i.msg||"未知错误"));case 20:return t.abrupt("return",i);case 23:if(t.prev=23,t.t0=t["catch"](2),clearTimeout(a),"AbortError"!==t.t0.name){t.next=28;break}throw new Error("API请求超时");case 28:throw console.error("❌ API请求失败:",t.t0),t.t0;case 30:case"end":return t.stop()}}),t,null,[[2,23]])}))),h.apply(this,arguments)}function f(t){return d.apply(this,arguments)}function d(){return d=(0,a.A)((0,n.A)().mark((function t(e){var r,a,o,c,u;return(0,n.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=l(e),o=(0,n.A)().mark((function t(){var e,o;return(0,n.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,console.log("🔄 API调用尝试 ".concat(u,"/").concat(s.maxRetries)),t.next=4,p(r);case 4:return e=t.sent,t.abrupt("return",{v:e});case 8:if(t.prev=8,t.t0=t["catch"](0),a=t.t0,!(u<s.maxRetries)){t.next=16;break}return o=1e3*Math.pow(2,u),console.warn("⚠️ 第".concat(u,"次尝试失败，").concat(o,"ms后重试:"),t.t0.message),t.next=16,new Promise((function(t){return setTimeout(t,o)}));case 16:case"end":return t.stop()}}),t,null,[[0,8]])})),u=1;case 3:if(!(u<=s.maxRetries)){t.next=11;break}return t.delegateYield(o(),"t0",5);case 5:if(c=t.t0,!c){t.next=8;break}return t.abrupt("return",c.v);case 8:u++,t.next=3;break;case 11:throw console.error("❌ API调用失败，已达到最大重试次数 (".concat(s.maxRetries,"):"),a),a;case 13:case"end":return t.stop()}}),t)}))),d.apply(this,arguments)}function w(t){return b.apply(this,arguments)}function b(){return b=(0,a.A)((0,n.A)().mark((function t(e){var r;return(0,n.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e&&e.birthdate&&e.birthplace){t.next=3;break}throw new Error("缺少必要的出生信息（日期和地点）");case 3:return console.log("🌟 开始获取星盘数据"),console.log("👤 用户数据:",e),t.next=7,f(e);case 7:if(r=t.sent,r.data){t.next=10;break}throw new Error("API返回数据格式错误");case 10:return console.log("🎯 星盘数据获取成功"),t.abrupt("return",r.data);case 14:throw t.prev=14,t.t0=t["catch"](0),console.error("🚫 获取星盘数据失败:",t.t0),new Error("星盘API调用失败: ".concat(t.t0.message));case 18:case"end":return t.stop()}}),t,null,[[0,14]])}))),b.apply(this,arguments)}function m(){return A.apply(this,arguments)}function A(){return A=(0,a.A)((0,n.A)().mark((function t(){var e;return(0,n.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e={birthdate:"1981-11-17",birthHour:0,birthMinute:50,birthplace:"浙江省台州市天台县"},t.next=4,w(e);case 4:return t.abrupt("return",!0);case 7:return t.prev=7,t.t0=t["catch"](0),console.error("API健康检查失败:",t.t0),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,null,[[0,7]])}))),A.apply(this,arguments)}function g(t){t&&"string"===typeof t&&(s.defaultToken=t,console.log("🔑 API令牌已更新"))}function v(){return{baseUrl:s.baseUrl,timeout:s.timeout,maxRetries:s.maxRetries,hasToken:!!s.defaultToken}}}}]);
//# sourceMappingURL=829.1748759f.js.map